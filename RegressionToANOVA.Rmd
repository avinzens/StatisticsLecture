---
title: "Statistics for HCI"
author: "Chat Wacharamanotham"
date: "October 6, 2017"
runtime: shiny
---

```{r setup, echo=FALSE}
if (!require("pacman")) install.packages("pacman", repos='https://stat.ethz.ch/CRAN/'); library(pacman)
p_load(ggplot2, DT, dplyr, tidyr)

```

# Linear regression

Recall the linear equation below?
$$y = \beta_0 + \beta_1x$$
$\beta_0$ is the intercept to the y-axis and $\beta_1$ is the slope. Suppose that we have a linear equation with the parameters below, we can plot this equation on the following graph.
```{r}
beta0 <- 25 # y-intercept
beta1 <- 3 # slope
twoPoints <- data.frame(x = c(0, 1), y = c(beta0, (beta0 + beta1 * 1)))
ggplot(twoPoints, aes(x = x, y = y)) +
  geom_blank() +
  geom_abline(intercept = beta0, slope = beta1) +
  xlim(c(0,30)) +
  ylim(c(0,125)) +
  geom_point(data = twoPoints) +
  geom_text(data = twoPoints, aes(label= paste0("(", x, ",", y, ")")), angle = 60, hjust = 0, vjust = 0)
```

What you can interpret from this graph is that when $x$ is zero, $y$ is `r beta0`. Yes! the $\beta_0$ is exactly the value of $y$ when $x$ is zero. Also, when $x$ increases one unit (shown: from zero to one), $y$ increases by `r beta1`, which is the value of the slope. These two basic concepts will be useful later on.


# Linear model
Suppose we have a dataset of $x$ and $y$ like below:
```{r}
data1 <- data.frame(x = c(4, 4, 7, 7, 8, 9, 10, 10, 10, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15, 16, 16, 17, 17, 17, 18, 18, 18, 18, 19, 19, 19, 20, 20, 20, 20, 20, 22, 23, 24, 24, 24, 24, 25),
                   y = c(2, 10, 4, 22, 16, 10, 18, 26, 34, 17, 28, 14, 20, 24, 28, 26, 34, 34, 46, 26, 36, 60, 80, 20, 26, 54, 32, 40, 32, 40, 50, 42, 56, 76, 84, 36, 46, 68, 32, 48, 52, 56, 64, 66, 54, 70, 92, 93, 120, 85))
datatable(data1)
```

We can show this data on a scatter plot.
```{r}
ggplot(data1, aes(x = x, y = y)) +
  geom_point() +
  xlim(c(0,30)) +
  ylim(c(0,125))
```

You might notice that there seem to be a trend in this data. As $x$ increses, $y$ seems to increase as well. In fact, we may explain this trend with a line like below.

```{r}
b0 <- -10
b1 <- 5
ggplot(data1, aes(x = x, y = y)) +
  geom_point() +
  geom_abline(intercept = b0, slope = b1)
```

```{r, echo=FALSE}
inputPanel(
  sliderInput("b0", label = "\\(\\beta_0\\):",
              min = -10, max = 10, value = -10),
  
  sliderInput("b1", label = "\\(\\beta_1\\):",
              min = -10, max = 10, value = 5),
  
  sliderInput("baseSize", label = "baseSize:",
              min = 10, max = 40, value = 25),
  
  sliderInput("pointSize", label = "pointSize:",
              min = 1, max = 10, value = 3),
  
  sliderInput("lineSize", label = "lineSize:",
              min = 1, max = 10, value = 2),
  
  sliderInput("grayedLineSize", label = "grayedLineSize:",
              min = 1, max = 10, value = 3)
)

calcError <- function(data, b0, b1) {
  data.frame(x = data$x, y = data$y, xend = data$x, yend = input$b0 + input$b1 * data$x)
}

renderPlot({
  theme_set(theme_dark(base_size = input$baseSize))  # plot size
  
  meanY <- mean(data1$y)
  errLines <- calcError(data1, b0, b1)
  ggplot(data1, aes(x = x, y = y)) + 
    geom_hline(yintercept=meanY, color = "darkgray", size = input$grayedLineSize) +
    geom_abline(intercept = input$b0, slope = input$b1, size = input$lineSize) +
    geom_segment(data = errLines, aes(x = x, y = y, xend = xend, yend = yend), linetype = "dotted", color = "red", size = input$lineSize) +
    geom_point(size = input$pointSize) +
    xlim(c(0,30)) +
    ylim(c(0,125))
})

renderPlot({
  theme_set(theme_gray(base_size = input$baseSize))  # plot size
  
  meanY <- mean(data1$y)
  errLines <- calcError(data1, b0, b1)
  ggplot(data1, aes(x = x, y = y)) +
    geom_hline(yintercept=meanY, color = "darkgray", size = input$grayedLineSize) +
    geom_point(size = input$pointSize) +
    geom_abline(intercept = input$b0, slope = input$b1, size = input$lineSize) +
    geom_segment(data = errLines, aes(x = x, y = y, xend = xend, yend = yend), linetype = "dotted", color = "red") +
    xlim(c(0,30)) +
    ylim(c(0,125))
})

renderUI({ 
    errLines <- calcError(data1, input$b0, input$b1)  
    SS_R <- sum((errLines$yend - errLines$y)^2)
    withMathJax(sprintf("\\(SS\\_R\\) = %d", SS_R))
})
```


Hmm. This line doesn't seem to explain the data well. How do you know? Because the actual data points seem to be faraway from the line. 

```{r}
errLines <- data.frame(x = data1$x, y = data1$y, xend = data1$x, yend = b0 + b1 * data1$x)
ggplot(data1, aes(x = x, y = y)) +
  geom_point() +
  geom_abline(intercept = b0, slope = b1) +
  geom_segment(data = errLines, aes(x = x, y = y, xend = xend, yend = yend), linetype = "dotted", color = "red") +
  xlim(c(0,30)) +
  ylim(c(0,125))
SS_R <- sum((errLines$yend - errLines$y)^2)
```

Actually, there is an algorithm to find the best line. This is call ordinary least square.

```{r}
m <- lm(y ~ x, data1)
b0 <- m$coefficients[1]
b1 <- m$coefficients["x"]
```

Which gives us $\beta_0$ = `r b0` and $\beta_1$ = `r b1`. Let's plot this
```{r}
ggplot(data1, aes(x = x, y = y)) +
  geom_point() +
  geom_abline(intercept = b0, slope = b1)
```
Looks better, isn't it?


