---
title: "Statistics 1"
output: html_document
runtime: shiny
---

```{r, echo=FALSE}
source("config.R")
if (!require("pacman")) install.packages("pacman", repos='https://stat.ethz.ch/CRAN/'); library(pacman)
p_load(ggplot2, 
       grid, 
       DT, 
       dplyr, 
       tidyr, 
       knitr, 
       httpuv, 
       shiny, 
       scatterD3, 
       ggvis,
       cowplot)

theme_set(theme_gray()) # disable cowplot white theme
```

```{r child = 'chapter1.Rmd'}
```


```{r, echo=FALSE}
n <- 30
satLevels <- c("Strongly dissatisfied", "Dissatisfied", "Neutral", "Satisfied", "Strongly satisfied")
df <- data.frame(
  UserId=1:n, 
  Major=sample(c("Math", "Science", "Language", "Arts"), n, replace=T),
  Satisfaction=factor(sample(satLevels, n, replace=T), levels = satLevels),
  TaskCompletionTime=rnorm(n, mean = 15, sd = 2)
)
displayTable(df)
```

### Nominal data: study majors of participants

We can show the nominal data as a stack of dots. Each dot represent a participant.

Note that for data in the nominal scale, the order of the category doesn't matter. The following two graphs shows the same data.

```{r, echo=FALSE, fig.height = 3}

pMajor <- ggplot(df, aes(x=Major)) + 
  geom_dotplot(binwidth = 1/10) +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())

df2 <- df
df2$Major <- relevel(df2$Major, "Math")
df2$Major <- relevel(df2$Major, "Science")

pMajor2 <- pMajor %+% df2

plot_grid(pMajor, pMajor2, align='h')
```





### Ordinal data: satisfaction rate
Here, it does matter to show the data in order from "Strongly dissatisfied" to "Strongly satisfied".
```{r, echo=FALSE, fig.height = 3}
pSatisfaction <- ggplot(df, aes(x=Satisfaction)) + 
  geom_dotplot(binwidth = 1/10) +
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())
pSatisfaction
```

### Ratio data: task completion time
For ratio data, like task completion time, there are a lot of distinct numbers, some differs only at decimal places. Therefore, it's not useful to use stacked dot plot. Instead, we use the **histogram**. A histogram has defines *bins* which is usually equal intervals. Data points are groupped by the bins. The number of data points in each bin is represented by the height of each bar. Below, the histogram (grey) is superimposed with the raw data dots (unstacked, in blue).

#### Demo 1: Bin width of histogram
Changing the bin width may change how the histogram looks. Try this out with the slider below the histogram

```{r, echo=FALSE}
iTCTBase <- df %>% 
  ggvis(~TaskCompletionTime) %>% 
  scale_numeric("x", domain = c(0, max(df$TaskCompletionTime) + 2), nice = FALSE) 
```


```{r, echo = FALSE, fig.height = 3, fig.width = 5}
binWidthSlider <- input_slider(min = 1, max = 5, value = 1, step = 0.5)
iTCTBase %>%
  layer_histograms(width = binWidthSlider, fill := "gray") %>%
  layer_points(y = 0, fillOpacity := 0.5, fill := "blue")
```

#Describing data
There are several things that we can say about data. We will be *describing* the dataset itself. We usually interest in whereabout the data points tend to be. There are several statistics that are useful for this. 

##Mode
The *mode* of a data is the score or category with the greatest frequency. This usually makes sense in nominal and ordinal data.

```{r, echo = FALSE, fig.height = 3}
Mode <- function(x) {
  ux <- unique(x)
  tab <- tabulate(match(x, ux)); ux[tab == max(tab)]
}
majorModes <- as.character(Mode(df$Major))
satModes <- as.character(Mode(df$Satisfaction))

txtModeMaj <- sprintf("Mode(s): %s", paste(majorModes, collapse = ", "))
txtModeSat <- sprintf("Mode(s): %s", paste(satModes, collapse = ", "))

pModeMajor <- pMajor + annotate("text", x = 2.5, y = 8, label = txtModeMaj)
pModeSat <- pSatisfaction + annotation_custom(
    textGrob(txtModeSat), 
    xmin = -Inf, xmax = Inf, ymin = 1, ymax = 1)

plot_grid(
  pModeMajor,
  pModeSat,
  ncol = 2
)
```

##Median

Median is the middle data point from the sorted data. When there are even number of data points, the median is the average between the two data points at the center.

##Mean
Mean is the sum of all data points divided by the number of data points.

##Demo 2: Central tendencies
The following demo shows the relationship between mean, median, and mode(s).
(NOTE: If you don't see four graphs after clicking "Sample 1000 times", run this demo in RStudio from: `apps/01_descriptives/app.R`)
```{r, echo = FALSE}
shinyAppDir(
  "apps/01_descriptives",
  options=list(height="900px")
  
)
```

#Central limit theorem
Regardless of the shape of the parent population, the sampling distribution of means derived from a large number of random samples drawn from that parent distribution will exhibit a normal distribution.

##Demo 3: Central Limit Theorem
(NOTE: If you don't see four graphs after clicking "Sample 1000 times", run this demo in RStudio from: `apps/02_centralLimitTheorem/app.R`)
```{r, echo = FALSE}
shinyAppDir(
  "apps/02_centralLimitTheorem",
  options=list(height="800px"
  )
)
```


